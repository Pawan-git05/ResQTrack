<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Donate - ResQTrack</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
	<link href="./assets/css/styles.css" rel="stylesheet" />
</head>
<body>
	<nav class="navbar navbar-expand-lg bg-body-tertiary">
		<div class="container">
			<a class="navbar-brand" href="./index.html">üêæ <span>ResQTrack</span></a>
		</div>
	</nav>
	<div class="container py-4">
		<a href="./index.html" class="back-btn mb-3">‚¨Ö Go Back to ResQTrack</a>
		<h1 class="h4 mb-3">Donate</h1>
		<form id="donation-form" class="row g-3">
			<div class="col-md-6">
				<label class="form-label">Name</label>
				<input name="donor_name" class="form-control" />
			</div>
			<div class="col-md-6">
				<label class="form-label">Email</label>
				<input name="donor_email" type="email" class="form-control" data-validate="email" />
				<div class="invalid-feedback"></div>
			</div>
			<div class="col-md-4">
				<label class="form-label">Amount</label>
				<input name="amount" type="number" min="1" step="1" class="form-control" required data-validate="required|number" />
				<div class="invalid-feedback"></div>
			</div>
			<div class="col-md-4">
				<label class="form-label">Currency</label>
				<select name="currency" class="form-select">
					<option>INR</option>
					<option>USD</option>
				</select>
			</div>
			<div class="col-md-4">
				<label class="form-label">Category</label>
				<select name="category" class="form-select" required data-validate="required">
					<option value="Medical Aid">Medical Aid</option>
					<option value="Food Supplies">Food Supplies</option>
					<option value="Shelter / Rehabilitation">Shelter / Rehabilitation</option>
				</select>
				<div class="invalid-feedback"></div>
			</div>
			<div class="col-12">
				<button class="btn btn-gradient-green" type="submit">Donate</button>
			</div>
		</form>
		<div id="result" class="alert d-none mt-3" role="alert" style="display:none"></div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<script src="./assets/js/app.js"></script>
	<script src="./assets/js/api.js"></script>
	<script>
		const form = document.getElementById('donation-form');
		const result = document.getElementById('result');
		document.addEventListener('DOMContentLoaded', () => {
			if (window.FormValidator) window.FormValidator.attachRealTimeValidation(form);
			const amountField = form.querySelector('input[name="amount"]');
			amountField.addEventListener('input', () => {
				const value = Number(amountField.value);
				if (!Number.isNaN(value) && value > 0) {
					amountField.classList.add('is-valid');
					amountField.classList.remove('is-invalid');
				} else if (amountField.value) {
					amountField.classList.add('is-invalid');
					amountField.classList.remove('is-valid');
				}
			});
		});
		form.addEventListener('submit', async (e) => {
			e.preventDefault();
			const submitBtn = form.querySelector('button[type="submit"]');
			let allValid = true;
			form.querySelectorAll('[data-validate]').forEach((field) => { if (window.FormValidator && !window.FormValidator.validateField(field)) allValid = false; });
			const amt = Number(form.amount.value);
			if (Number.isNaN(amt) || amt <= 0) { allValid = false; form.amount.classList.add('is-invalid'); }
			if (!allValid) { window.ToastManager?.error('Please enter a valid amount and required fields'); return; }
			const payload = Object.fromEntries(new FormData(form).entries());
			payload.amount = Number(payload.amount);
			try {
				await window.ResQApi.createDonation(payload, { buttonElement: submitBtn });
				window.ToastManager?.success('Thank you for your donation!');
				form.reset();
				form.querySelectorAll('.is-valid,.is-invalid').forEach(el => el.classList.remove('is-valid','is-invalid'));
			} catch (err) {
				// handled globally
			}
		});
	</script>
</body>
</html>
