<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Admin Dashboard - ResQTrack</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
	<link href="./assets/css/styles.css" rel="stylesheet" />
	<style>
		.stats-card {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
			border-radius: 10px;
			padding: 20px;
			margin-bottom: 20px;
		}
		.stats-number {
			font-size: 2.5rem;
			font-weight: bold;
		}
		.table-responsive {
			border-radius: 10px;
			overflow: hidden;
			box-shadow: 0 4px 6px rgba(0,0,0,0.1);
		}
		.badge-status {
			font-size: 0.8rem;
		}
		.refresh-btn {
			position: fixed;
			bottom: 20px;
			right: 20px;
			z-index: 1000;
		}
	</style>
</head>
<body>
	<nav class="navbar navbar-expand-lg bg-body-tertiary">
		<div class="container">
			<a class="navbar-brand" href="./index.html">üêæ <span>ResQTrack</span></a>
			<span class="navbar-text">Admin Dashboard</span>
		</div>
	</nav>
	
	<div class="container py-4">
		<h1 class="h3 mb-4">üìä Admin Dashboard</h1>
		
		<!-- Statistics Cards -->
		<div class="row mb-4">
			<div class="col-md-3">
				<div class="stats-card text-center">
					<div class="stats-number" id="total-cases">-</div>
					<div>Total Cases</div>
				</div>
			</div>
			<div class="col-md-3">
				<div class="stats-card text-center">
					<div class="stats-number" id="total-ngos">-</div>
					<div>Registered NGOs</div>
				</div>
			</div>
			<div class="col-md-3">
				<div class="stats-card text-center">
					<div class="stats-number" id="total-volunteers">-</div>
					<div>Volunteers</div>
				</div>
			</div>
			<div class="col-md-3">
				<div class="stats-card text-center">
					<div class="stats-number" id="total-donations">-</div>
					<div>Donations</div>
				</div>
			</div>
		</div>

		<!-- Tabs for different data views -->
		<ul class="nav nav-tabs" id="adminTabs" role="tablist">
			<li class="nav-item" role="presentation">
				<button class="nav-link active" id="cases-tab" data-bs-toggle="tab" data-bs-target="#cases" type="button" role="tab">
					üö® Cases
				</button>
			</li>
			<li class="nav-item" role="presentation">
				<button class="nav-link" id="ngos-tab" data-bs-toggle="tab" data-bs-target="#ngos" type="button" role="tab">
					üè¢ NGOs
				</button>
			</li>
			<li class="nav-item" role="presentation">
				<button class="nav-link" id="volunteers-tab" data-bs-toggle="tab" data-bs-target="#volunteers" type="button" role="tab">
					üë• Volunteers
				</button>
			</li>
			<li class="nav-item" role="presentation">
				<button class="nav-link" id="donations-tab" data-bs-toggle="tab" data-bs-target="#donations" type="button" role="tab">
					üí∞ Donations
				</button>
			</li>
			<li class="nav-item" role="presentation">
				<button class="nav-link" id="hospitals-tab" data-bs-toggle="tab" data-bs-target="#hospitals" type="button" role="tab">
					üè• Hospitals
				</button>
			</li>
		</ul>

		<div class="tab-content border border-top-0 p-3" id="adminTabContent">
			<!-- Cases Tab -->
			<div class="tab-pane fade show active" id="cases" role="tabpanel">
				<div class="table-responsive">
					<table class="table table-hover">
						<thead class="table-dark">
							<tr>
								<th>Case Code</th>
								<th>Reporter</th>
								<th>Location</th>
								<th>Animal</th>
								<th>Urgency</th>
								<th>Status</th>
								<th>Date</th>
							</tr>
						</thead>
						<tbody id="cases-table-body">
							<tr><td colspan="7" class="text-center">Loading...</td></tr>
						</tbody>
					</table>
				</div>
			</div>

			<!-- NGOs Tab -->
			<div class="tab-pane fade" id="ngos" role="tabpanel">
				<div class="table-responsive">
					<table class="table table-hover">
						<thead class="table-dark">
							<tr>
								<th>Name</th>
								<th>Email</th>
								<th>Phone</th>
								<th>Location</th>
								<th>Operating Zones</th>
								<th>Status</th>
								<th>Date</th>
							</tr>
						</thead>
						<tbody id="ngos-table-body">
							<tr><td colspan="7" class="text-center">Loading...</td></tr>
						</tbody>
					</table>
				</div>
			</div>

			<!-- Volunteers Tab -->
			<div class="tab-pane fade" id="volunteers" role="tabpanel">
				<div class="table-responsive">
					<table class="table table-hover">
						<thead class="table-dark">
							<tr>
								<th>Name</th>
								<th>Email</th>
								<th>Phone</th>
								<th>Expertise</th>
								<th>Location</th>
								<th>Status</th>
								<th>Date</th>
							</tr>
						</thead>
						<tbody id="volunteers-table-body">
							<tr><td colspan="7" class="text-center">Loading...</td></tr>
						</tbody>
					</table>
				</div>
			</div>

			<!-- Donations Tab -->
			<div class="tab-pane fade" id="donations" role="tabpanel">
				<div class="table-responsive">
					<table class="table table-hover">
						<thead class="table-dark">
							<tr>
								<th>Donor</th>
								<th>Amount</th>
								<th>Category</th>
								<th>Payment ID</th>
								<th>Date</th>
							</tr>
						</thead>
						<tbody id="donations-table-body">
							<tr><td colspan="5" class="text-center">Loading...</td></tr>
						</tbody>
					</table>
				</div>
			</div>

			<!-- Hospitals Tab -->
			<div class="tab-pane fade" id="hospitals" role="tabpanel">
				<div class="table-responsive">
					<table class="table table-hover">
						<thead class="table-dark">
							<tr>
								<th>Name</th>
								<th>Address</th>
								<th>Phone</th>
								<th>24x7</th>
								<th>Treatment Types</th>
								<th>Date</th>
							</tr>
						</thead>
						<tbody id="hospitals-table-body">
							<tr><td colspan="6" class="text-center">Loading...</td></tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>

	<!-- Refresh Button -->
	<button class="btn btn-primary refresh-btn" onclick="loadAllData()" title="Refresh Data">
		üîÑ Refresh
	</button>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<script src="./assets/js/api.js"></script>
	<script>
		// Admin API functions
		window.AdminApi = {
			getAllCases: () => fetch('http://localhost:5000/admin/cases').then(r => r.json()),
			getAllNGOs: () => fetch('http://localhost:5000/admin/ngos').then(r => r.json()),
			getAllVolunteers: () => fetch('http://localhost:5000/admin/volunteers').then(r => r.json()),
			getAllDonations: () => fetch('http://localhost:5000/admin/donations').then(r => r.json()),
			getAllHospitals: () => fetch('http://localhost:5000/admin/hospitals').then(r => r.json()),
		};

		function formatDate(dateString) {
			return new Date(dateString).toLocaleDateString() + ' ' + new Date(dateString).toLocaleTimeString();
		}

		function getStatusBadge(status, approved = null) {
			if (approved !== null) {
				return approved ? '<span class="badge bg-success badge-status">Approved</span>' : '<span class="badge bg-warning badge-status">Pending</span>';
			}
			const statusMap = {
				'PENDING': 'warning',
				'IN_PROGRESS': 'info',
				'RESCUED': 'success',
				'CLOSED': 'secondary'
			};
			return `<span class="badge bg-${statusMap[status] || 'secondary'} badge-status">${status}</span>`;
		}

		function getUrgencyBadge(urgency) {
			const urgencyMap = {
				'Low': 'success',
				'Medium': 'warning',
				'Critical': 'danger'
			};
			return `<span class="badge bg-${urgencyMap[urgency] || 'secondary'} badge-status">${urgency}</span>`;
		}

		async function loadCases() {
			try {
				const data = await window.AdminApi.getAllCases();
				const tbody = document.getElementById('cases-table-body');
				if (data.cases && data.cases.length > 0) {
					tbody.innerHTML = data.cases.map(case_ => `
						<tr>
							<td><strong>${case_.case_code}</strong></td>
							<td>${case_.reporter_name || 'Anonymous'}<br><small>${case_.reporter_phone}</small></td>
							<td>${case_.location}</td>
							<td>${case_.animal_type}</td>
							<td>${getUrgencyBadge(case_.urgency)}</td>
							<td>${getStatusBadge(case_.status)}</td>
							<td><small>${formatDate(case_.created_at)}</small></td>
						</tr>
					`).join('');
				} else {
					tbody.innerHTML = '<tr><td colspan="7" class="text-center text-muted">No cases found</td></tr>';
				}
				document.getElementById('total-cases').textContent = data.cases ? data.cases.length : 0;
			} catch (error) {
				console.error('Error loading cases:', error);
				document.getElementById('cases-table-body').innerHTML = '<tr><td colspan="7" class="text-center text-danger">Error loading cases</td></tr>';
			}
		}

		async function loadNGOs() {
			try {
				const data = await window.AdminApi.getAllNGOs();
				const tbody = document.getElementById('ngos-table-body');
				if (data.ngos && data.ngos.length > 0) {
					tbody.innerHTML = data.ngos.map(ngo => `
						<tr>
							<td><strong>${ngo.name}</strong></td>
							<td>${ngo.email}</td>
							<td>${ngo.phone}</td>
							<td>${ngo.location || '-'}</td>
							<td>${ngo.operating_zones || '-'}</td>
							<td>${getStatusBadge(null, ngo.approved)}</td>
							<td><small>${formatDate(ngo.created_at)}</small></td>
						</tr>
					`).join('');
				} else {
					tbody.innerHTML = '<tr><td colspan="7" class="text-center text-muted">No NGOs found</td></tr>';
				}
				document.getElementById('total-ngos').textContent = data.ngos ? data.ngos.length : 0;
			} catch (error) {
				console.error('Error loading NGOs:', error);
				document.getElementById('ngos-table-body').innerHTML = '<tr><td colspan="7" class="text-center text-danger">Error loading NGOs</td></tr>';
			}
		}

		async function loadVolunteers() {
			try {
				const data = await window.AdminApi.getAllVolunteers();
				const tbody = document.getElementById('volunteers-table-body');
				if (data.volunteers && data.volunteers.length > 0) {
					tbody.innerHTML = data.volunteers.map(vol => `
						<tr>
							<td><strong>${vol.name}</strong></td>
							<td>${vol.email}</td>
							<td>${vol.phone}</td>
							<td>${vol.expertise || '-'}</td>
							<td>${vol.location || '-'}</td>
							<td>${getStatusBadge(null, vol.approved)}</td>
							<td><small>${formatDate(vol.created_at)}</small></td>
						</tr>
					`).join('');
				} else {
					tbody.innerHTML = '<tr><td colspan="7" class="text-center text-muted">No volunteers found</td></tr>';
				}
				document.getElementById('total-volunteers').textContent = data.volunteers ? data.volunteers.length : 0;
			} catch (error) {
				console.error('Error loading volunteers:', error);
				document.getElementById('volunteers-table-body').innerHTML = '<tr><td colspan="7" class="text-center text-danger">Error loading volunteers</td></tr>';
			}
		}

		async function loadDonations() {
			try {
				const data = await window.AdminApi.getAllDonations();
				const tbody = document.getElementById('donations-table-body');
				if (data.donations && data.donations.length > 0) {
					tbody.innerHTML = data.donations.map(donation => `
						<tr>
							<td>${donation.donor_name || 'Anonymous'}<br><small>${donation.donor_email || ''}</small></td>
							<td><strong>${donation.currency} ${donation.amount}</strong></td>
							<td>${donation.category}</td>
							<td><small>${donation.payment_id || '-'}</small></td>
							<td><small>${formatDate(donation.created_at)}</small></td>
						</tr>
					`).join('');
				} else {
					tbody.innerHTML = '<tr><td colspan="5" class="text-center text-muted">No donations found</td></tr>';
				}
				document.getElementById('total-donations').textContent = data.donations ? data.donations.length : 0;
			} catch (error) {
				console.error('Error loading donations:', error);
				document.getElementById('donations-table-body').innerHTML = '<tr><td colspan="5" class="text-center text-danger">Error loading donations</td></tr>';
			}
		}

		async function loadHospitals() {
			try {
				const data = await window.AdminApi.getAllHospitals();
				const tbody = document.getElementById('hospitals-table-body');
				if (data.hospitals && data.hospitals.length > 0) {
					tbody.innerHTML = data.hospitals.map(hospital => `
						<tr>
							<td><strong>${hospital.name}</strong></td>
							<td>${hospital.address || '-'}</td>
							<td>${hospital.phone || '-'}</td>
							<td>${hospital.is_24x7 ? '<span class="badge bg-success">Yes</span>' : '<span class="badge bg-secondary">No</span>'}</td>
							<td>${hospital.treatment_types || '-'}</td>
							<td><small>${formatDate(hospital.created_at)}</small></td>
						</tr>
					`).join('');
				} else {
					tbody.innerHTML = '<tr><td colspan="6" class="text-center text-muted">No hospitals found</td></tr>';
				}
			} catch (error) {
				console.error('Error loading hospitals:', error);
				document.getElementById('hospitals-table-body').innerHTML = '<tr><td colspan="6" class="text-center text-danger">Error loading hospitals</td></tr>';
			}
		}

		async function loadAllData() {
			await Promise.all([
				loadCases(),
				loadNGOs(),
				loadVolunteers(),
				loadDonations(),
				loadHospitals()
			]);
		}

		// Load data when page loads
		document.addEventListener('DOMContentLoaded', loadAllData);
	</script>
</body>
</html>
