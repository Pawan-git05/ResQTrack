<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Register - ResQTrack</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
	<link href="./assets/css/styles.css" rel="stylesheet" />
</head>
<body>
	<nav class="navbar navbar-expand-lg bg-body-tertiary">
		<div class="container">
			<a class="navbar-brand" href="./index.html">üêæ <span>ResQTrack</span></a>
		</div>
	</nav>
	<div class="container py-4">
		<a href="./index.html" class="back-btn mb-3">‚¨Ö Go Back to ResQTrack</a>
		<h1 class="h4 mb-3">Join the Network</h1>
		<ul class="nav nav-tabs" id="tabs" role="tablist">
			<li class="nav-item" role="presentation">
				<button class="nav-link active" data-bs-toggle="tab" data-bs-target="#ngo" type="button" role="tab">NGO</button>
			</li>
			<li class="nav-item" role="presentation">
				<button class="nav-link" data-bs-toggle="tab" data-bs-target="#vol" type="button" role="tab">Volunteer</button>
			</li>
		</ul>
		<div class="tab-content border border-top-0 p-3">
			<div class="tab-pane fade show active" id="ngo" role="tabpanel">
				<form id="ngo-form" class="row g-3">
					<div class="col-md-6">
						<label class="form-label">Organization Name</label>
						<input name="name" class="form-control" required data-validate="required" />
						<div class="invalid-feedback"></div>
					</div>
					<div class="col-md-6">
						<label class="form-label">Email</label>
						<input name="email" type="email" class="form-control" required data-validate="required|email" />
						<div class="invalid-feedback"></div>
					</div>
					<div class="col-md-6">
						<label class="form-label">Phone</label>
						<input name="phone" class="form-control" required data-validate="required|phone" />
						<div class="invalid-feedback"></div>
					</div>
					<div class="col-md-6">
						<label class="form-label">Operating Zones</label>
						<input name="operating_zones" class="form-control" />
					</div>
					<div class="col-12">
						<button class="btn btn-gradient-blue" type="submit">Submit</button>
					</div>
				</form>
			</div>
			<div class="tab-pane fade" id="vol" role="tabpanel">
				<form id="vol-form" class="row g-3">
					<div class="col-md-6">
						<label class="form-label">Name</label>
						<input name="name" class="form-control" required data-validate="required" />
						<div class="invalid-feedback"></div>
					</div>
					<div class="col-md-6">
						<label class="form-label">Email</label>
						<input name="email" type="email" class="form-control" required data-validate="required|email" />
						<div class="invalid-feedback"></div>
					</div>
					<div class="col-md-6">
						<label class="form-label">Phone</label>
						<input name="phone" class="form-control" required data-validate="required|phone" />
						<div class="invalid-feedback"></div>
					</div>
					<div class="col-md-6">
						<label class="form-label">Expertise</label>
						<select name="expertise" class="form-select">
							<option value="Pickup">Pickup</option>
							<option value="First Aid">First Aid</option>
							<option value="Foster Care">Foster Care</option>
						</select>
					</div>
					<div class="col-12">
						<button class="btn btn-gradient-blue" type="submit">Submit</button>
					</div>
				</form>
			</div>
		</div>
		<div id="result" class="alert d-none mt-3" role="alert" style="display:none"></div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<script src="./assets/js/app.js"></script>
	<script src="./assets/js/api.js"></script>
	<script>
		const ngoForm = document.getElementById('ngo-form');
		const volForm = document.getElementById('vol-form');
		const result = document.getElementById('result');

		document.addEventListener('DOMContentLoaded', () => {
			if (window.FormValidator) {
				window.FormValidator.attachRealTimeValidation(ngoForm);
				window.FormValidator.attachRealTimeValidation(volForm);
			}
			// Clear validation on tab switch
			document.querySelectorAll('[data-bs-toggle="tab"]').forEach(btn => {
				btn.addEventListener('shown.bs.tab', () => {
					[ngoForm, volForm].forEach(f => f.querySelectorAll('.is-valid,.is-invalid').forEach(el => el.classList.remove('is-valid','is-invalid')));
				});
			});
		});

		ngoForm.addEventListener('submit', async (e) => {
			e.preventDefault();
			const submitBtn = ngoForm.querySelector('button[type="submit"]');
			let allValid = true;
			ngoForm.querySelectorAll('[data-validate]').forEach((field) => { if (window.FormValidator && !window.FormValidator.validateField(field)) allValid = false; });
			if (!allValid) { window.ToastManager?.error('Please fix validation errors'); return; }
			const payload = Object.fromEntries(new FormData(ngoForm).entries());
			try {
				await window.ResQApi.registerNGO(payload, { buttonElement: submitBtn });
				window.ToastManager?.success('NGO registration submitted for approval.');
				ngoForm.reset();
				ngoForm.querySelectorAll('.is-valid,.is-invalid').forEach(el => el.classList.remove('is-valid','is-invalid'));
			} catch (err) {
				if (err && err.status === 409) window.ToastManager?.error('Email already registered.');
			}
		});

		volForm.addEventListener('submit', async (e) => {
			e.preventDefault();
			const submitBtn = volForm.querySelector('button[type="submit"]');
			let allValid = true;
			volForm.querySelectorAll('[data-validate]').forEach((field) => { if (window.FormValidator && !window.FormValidator.validateField(field)) allValid = false; });
			if (!allValid) { window.ToastManager?.error('Please fix validation errors'); return; }
			const payload = Object.fromEntries(new FormData(volForm).entries());
			try {
				await window.ResQApi.registerVolunteer(payload, { buttonElement: submitBtn });
				window.ToastManager?.success('Volunteer registration submitted for approval.');
				volForm.reset();
				volForm.querySelectorAll('.is-valid,.is-invalid').forEach(el => el.classList.remove('is-valid','is-invalid'));
			} catch (err) {
				if (err && err.status === 409) window.ToastManager?.error('Email already registered.');
			}
		});
	</script>
</body>
</html>
